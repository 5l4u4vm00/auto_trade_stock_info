---
name: tw-stock-analyzer
description: 台灣股票每日分析與交易計畫產生器。當使用者提到「台股分析」、「今日台股」、「股票走勢」、「交易計畫」、「選股」、「技術指標」、「台灣股市」、「TWSE」、「盤後分析」、「看盤」或任何涉及台灣股市分析、技術面選股、當日交易策略的需求時，請使用此技能。即使使用者只是問「今天股市怎麼樣」或「有什麼股票可以買」，也應觸發此技能。
---

# 台灣股票每日分析與交易計畫產生器

## 概述

此技能讓 Claude 能夠：
1. 從公開 API 抓取台灣股市即時/收盤資料
2. 計算多種技術指標（MA、RSI、MACD、KD、布林通道等）
3. **整合 `news-stock-picker` 的新聞選股策略，結合基本面與新聞面分析**
4. 根據技術指標與新聞面資訊交叉篩選出值得關注的股票
5. **在產出交易計畫前，先與使用者討論預計執行方向**
6. 根據討論結果，產出完整的每日交易計畫文件

## 工作流程

整體流程分為六個階段，請嚴格按順序執行：

### 階段一：資料取得

執行資料抓取腳本，從公開 API 取得台股資料：

```bash
python3 .claude/skills/tw-stock-analyzer/scripts/fetch_twse_data.py
```

此腳本會：
- 從 TWSE（台灣證券交易所）OpenAPI 抓取當日所有上市股票收盤資料
- 從 TPEX（櫃買中心）抓取上櫃股票資料
- 資料包含：股票代號、名稱、開盤價、最高價、最低價、收盤價、成交量、漲跌幅
- 輸出為 CSV 格式存於 `tw_stock_data/`

如果 API 不可用（假日或盤中），腳本會嘗試取得最近一個交易日的資料。

**注意**：TWSE API 有時不穩定，若失敗請重試一次。若仍失敗，改用 web_search 搜尋「台股 今日收盤 行情」取得概要資料後手動分析。

### 階段二：技術指標計算

執行指標計算腳本：

```bash
python3 .claude/skills/tw-stock-analyzer/scripts/calculate_indicators.py
```

計算以下指標（需要歷史資料的指標會嘗試從 Yahoo Finance 抓取近期歷史）：

| 指標 | 說明 | 用途 |
|------|------|------|
| MA5/MA10/MA20/MA60 | 移動平均線 | 趨勢判斷 |
| RSI(14) | 相對強弱指標 | 超買超賣判斷（>70 超買, <30 超賣） |
| MACD | 指數平滑異同移動平均線 | 趨勢動能與交叉信號 |
| KD(9,3,3) | 隨機指標 | 短線超買超賣與黃金/死亡交叉 |
| 布林通道(20,2) | Bollinger Bands | 價格通道與突破判斷 |
| 成交量比 | 今日量 vs 5日均量 | 量能變化 |
| 漲跌幅排行 | 當日漲跌幅 | 市場強弱股辨識 |

輸出結果存於 `tw_stock_data/indicators.csv`

### 階段三：整合新聞選股策略

**在進行技術面篩選之前，必須先參考 `news-stock-picker` 產出的最新策略報告。**

1. **檢查是否有最新報告**：查看 `strategy/` 資料夾下是否存在近期的 `news_strategy_{YYYY-MM-DD}.md` 報告。
   - 若有 **7 天內** 的報告，直接讀取並擷取關鍵資訊。
   - 若沒有或報告已過時（超過 7 天），**先執行 `news-stock-picker` skill** 產出最新的新聞選股策略報告，再繼續後續流程。

2. **從新聞策略報告中擷取以下資訊**：
   - 本週投資主題（例如：AI 伺服器需求、綠能政策受惠等）
   - 各主題對應的受惠產業鏈與篩選條件
   - 新聞影響分析表中標示為 Bullish / High 的產業方向
   - 風險因素與需要迴避的產業

3. **將新聞面資訊納入技術面篩選的加權考量**：
   - 若某檔股票同時符合技術面多頭條件 **且** 屬於新聞面看好的產業主題，優先度提升為「強勢推薦」
   - 若某檔股票技術面良好但屬於新聞面標示為風險的產業，降級為「觀察」並加註警語
   - 在最終推薦清單中標注每檔股票是否有新聞面支撐，以及對應的投資主題

### 階段四：技術指標篩選

根據技術指標進行多維度篩選，找出值得關注的股票：

**買進信號篩選（多頭條件）：**
- RSI 從超賣區（<30）回升
- KD 黃金交叉（K 線向上穿越 D 線）
- MACD 柱狀圖由負轉正，或 DIF 上穿 MACD
- 股價站上 MA20 且 MA5 > MA10（均線多頭排列）
- 成交量放大（今日量 > 5日均量 1.5 倍以上）
- 股價觸及布林通道下緣後反彈

**賣出/警示信號篩選（空頭條件）：**
- RSI 進入超買區（>70）後回落
- KD 死亡交叉
- MACD 柱狀圖由正轉負
- 股價跌破 MA20 且均線空頭排列
- 成交量萎縮但股價仍在高檔

**特殊觀察：**
- 量價背離（價漲量縮或價跌量增）
- 布林通道收窄（即將變盤）
- 連續多日盤整後的突破

將篩選結果分類整理，並結合新聞面資訊：
- 🟢 **強勢買進候選**（符合 3 個以上多頭條件 **且** 有新聞面投資主題支撐）
- 🟡 **觀察追蹤清單**（符合 1-2 個技術條件，或技術面強但缺乏新聞面支撐）
- 🔴 **風險警示清單**（出現多個空頭信號，或新聞面有明確利空）

每檔股票需標注：
- 對應的新聞投資主題（若有）
- 技術面信號摘要
- 新聞面與技術面是否方向一致

### 階段五：討論與確認（關鍵步驟）

**在產出正式交易計畫前，必須先與使用者進行以下討論：**

這是此技能最重要的步驟。向使用者呈現分析結果後，Claude 必須：

1. **展示市場概況摘要**
   - 大盤指數走勢與成交量
   - 類股輪動情況
   - 市場情緒指標

2. **呈現篩選結果**
   - 列出各類別的候選股票及其指標數據
   - 標注每檔股票的關鍵信號

3. **提出初步交易方向建議**，並詢問使用者：
   - 目前的持倉狀況（已持有哪些股票？）
   - 風險偏好（積極/穩健/保守）
   - 可用資金規模（大概即可）
   - 偏好的交易週期（當沖/短線數日/波段數週）
   - 是否有特別關注的產業或個股
   - 對初步建議的看法與修改意見

4. **根據使用者回饋調整策略**
   - 結合使用者的風險偏好調整選股條件
   - 根據資金規模建議適當的部位大小
   - 根據交易週期調整進出場時機

使用 `ask_user_input_v0` 工具來收集使用者的偏好設定，讓討論更有效率。

### 階段六：產出交易計畫

經過討論確認後，產出完整的交易計畫文件（Markdown 格式），包含：

```markdown
# 📊 台股每日交易計畫
## 日期：YYYY-MM-DD

### 一、市場概況
- 加權指數：xxxxx 點（+/-x.xx%）
- 成交量：xxxx 億
- 市場情緒：[描述]

### 二、新聞面投資主題（來自新聞選股策略報告）
- 主題 1：{主題名稱} — {一句話摘要}
- 主題 2：{主題名稱} — {一句話摘要}
- ...
- 報告來源：`strategy/news_strategy_{YYYY-MM-DD}.md`

### 三、今日重點觀察
| 股票代號 | 名稱 | 收盤價 | 漲跌幅 | 技術信號 | 新聞面主題 |
|----------|------|--------|--------|----------|-----------|
| ...      | ...  | ...    | ...    | ...      | ...       |

### 四、交易策略

#### 買進計畫
| 標的 | 建議價位 | 停損價 | 目標價 | 預計部位 | 理由 | 新聞面支撐 |
|------|----------|--------|--------|----------|------|-----------|
| ...  | ...      | ...    | ...    | ...      | ...  | ✅/❌     |

#### 賣出/減碼計畫
| 標的 | 建議出場價 | 理由 |
|------|------------|------|
| ...  | ...        | ...  |

### 五、風險管理
- 單一標的最大部位：總資金 x%
- 今日總曝險上限：總資金 x%
- 停損紀律：[描述]

### 六、備註與提醒
- [盤前/盤後注意事項]
- [重要財經事件提醒]

### ⚠️ 免責聲明
本計畫僅供參考，不構成投資建議。投資有風險，請審慎評估自身風險承受能力。
```

將計畫文件儲存至 `outputs/trading_plan_YYYYMMDD.md` 並提供給使用者。

## 資料來源說明

此技能使用以下公開資料來源：

1. **TWSE OpenAPI**：`https://openapi.twse.com.tw/` — 上市股票即時/收盤行情
2. **TPEX API**：`https://www.tpex.org.tw/openapi/` — 上櫃股票行情
3. **Yahoo Finance**：透過 `yfinance` Python 套件取得歷史資料（用於計算需要回溯期的指標）
4. **Web Search**：作為備援，搜尋當日台股新聞與市場概況

## 重要提醒

- 台股交易時間為週一至週五 09:00-13:30（台灣時間）
- 若在盤中執行，資料為即時但可能不完整
- 若在盤後執行，資料為當日收盤定稿
- 週末或假日執行時，會取得最近一個交易日的資料
- **所有分析結果僅供參考，不構成投資建議**
- Claude 不是合格的投資顧問，使用者應自行承擔投資風險

## 依賴套件

腳本需要以下 Python 套件（若未安裝，腳本會自動嘗試安裝）：
- `pandas` — 資料處理
- `requests` — API 呼叫
- `yfinance` — Yahoo Finance 歷史資料
- `numpy` — 數值計算（pandas 依賴）

## 錯誤處理

如果遇到以下情況，請依照對應方式處理：

| 情況 | 處理方式 |
|------|----------|
| TWSE API 無回應 | 重試一次，若仍失敗則用 web_search 取得概要 |
| 假日無資料 | 提示使用者今日非交易日，取用最近交易日資料 |
| yfinance 歷史資料不足 | 降低指標計算精度，僅用可取得的資料 |
| 網路完全不可用 | 請使用者提供資料或改日再試 |

## 快速參考：技術指標判讀

詳細的技術指標說明與判讀方法請參閱：
```
references/indicator_guide.md
```
